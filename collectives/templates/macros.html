{#
      Macro: usericon(  user, 
                        show_info=False, 
                        info_url=None, 
                        with_license_tags=False,
                        competency_activities=None,
                        show_all_competencies=False)

      Rôle
      - Affiche une carte "icône utilisateur" (avatar + nom + infos optionnelles).

      Paramètres
      - user: utilisateur à afficher (collectives.models.User).
      - show_info: si true, affiche le nom complet + ligne d'infos (badges, tags licence).
                                           sinon, affiche seulement le nom abrégé. 
                                           Habituellement true pour les encadrants, false pour les inscrits.
      - info_url: URL de destination du clic quand show_info=true.
      - with_license_tags: active les tags de licence (-18, -25).
      - competency_activities: activités utilisées pour filtrer les badges de compétence.
      - show_all_competencies: affiche toutes les compétences si true, sinon filtrage standard.

      Comportement
      - Avatar utilisateur si présent, sinon avatar par défaut basé sur user.id.
      - Le composant est stylé via le CSS .usericon/.userlist.

      Exemples
      - leader_icon(leader): affiche un encadrant avec lien vers son profil encadrant.
      - registration_icon(registration): affiche un inscrit avec tags licence + badges.
#}
{% macro usericon(user, show_info=False, info_url=None, with_license_tags=False, competency_activities=None, show_all_competencies=False) -%}
<div class="usericon">
      <a class="usericon-wrapper" href="{%if show_info%}{{info_url}}{%else%}#{%endif%}"
                  alt="Avatar de {{user.abbrev_name()}}">
            <img class="usericon-avatar" src="{% if user.avatar
                        %}{{ url_for('images.crop', filename=user.avatar, width=80, height=80) }}{%
                  else
                        %}{{ url_for('static', filename='img/default/users/avatar-0'+ str(user.id % 6 + 1) +'.png')   }}{%
                  endif %}" />
            <span class="usericon-text">
                  {% if show_info %}
                        
                        <div class="usericon-text-name">{{user.full_name().title()}}</div>
                        <div class="usericon-text-info">
                              {% if with_license_tags %}
                                    {% if user.is_minor() %}
                                          <span class="tag">-18</span>
                                    {% elif user.is_youth() %}
                                          <span class="tag">-25</span>
                                    {% endif %}
                                   
                              {% endif %}
                              {% for badge in user.get_icon_competency_badges(activity_types=competency_activities, show_all=show_all_competencies) %}
                                    <span class="tag" title="{{ badge.level_name(with_activity=True) }}">{{ badge.level_name(short=True) }}</span>
                              {% endfor %}
                        </div>
                  {% else %}
                        <div class="usericon-text-name">{{user.abbrev_name().title()}}</div>
                  {% endif %}
            </span>
      </a>
</div>
{%- endmacro %}

{% macro leader_icon(leader) -%}
      {{usericon(leader, show_info=True, info_url=url_for("profile.show_leader", leader_id=leader.id))}}
{%- endmacro%}

{% macro registration_icon(registration) -%}
      {{ usericon(
            registration.user,
            show_info=registration.event.has_edit_rights(current_user),
            info_url=url_for("profile.show_user", user_id=registration.user.id, event_id=registration.event.id),
            with_license_tags=True,
            competency_activities=registration.event.activity_types,
            show_all_competencies=registration.event.show_all_badges,
      )}}
{%- endmacro%}

{% macro registration_admin_list_item(registration) -%}
<li>
      <a href="{{url_for('profile.show_user', user_id=registration.user.id, event_id=registration.event.id)}}">{{registration.user.full_name()}}</a>

      {% if registration.unsettled_payments() | length %}
        Paiements en cours:
        {% for p in registration.unsettled_payments() %}
           <a class="button button-secondary" href="{{url_for('payment.payment_details', payment_id=p.id)}}"> {{p.item.title}}</a>
        {% endfor %}
      {% elif registration.is_pending_payment() %}
      <a href="{{url_for('payment.report_offline', registration_id=registration.id)}}" class="button button-secondary">Saisir un paiement
            hors-ligne</a>
      {% endif %}

      <form class="inline" action="{{url_for('event.delete_registration', reg_id=registration.id)}}" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input type="submit" class="button button-danger" value="Effacer l'inscription">
      </form>
</li>
{%- endmacro %}
