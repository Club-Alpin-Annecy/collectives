
{% extends 'base.html' %}

{% import 'macros.html' as macros with context %}
{% import 'event/macros.html' as event_macros with context %}


{% block header %}
  {% block title %}Liste{% endblock %}
{% endblock %}

{% block additionalhead %}

  {# Autocomplete for leader lookup #}
  <script src="https://unpkg.com/js-autocomplete@1.0.4/auto-complete.min.js"></script>
  <link href="https://unpkg.com/js-autocomplete@1.0.4/auto-complete.css" rel="stylesheet">

  <script src="{{ url_for('static', filename='js/event/eventlist.js') }}"></script>
  <script src="{{ url_for('static', filename='js/tools.js') }}"></script>

  <script>
      window.onload = function() {
          gotoEvents(0);
          prepareEventClick();
          autocompleteLeaders();
      }
  </script>

{% endblock %}

{% block content %}


<div id="cover">
    <div><img src="{{ url_for('static', filename='caf/esprit club alpin.png') }}" class="motto"/>
        <br/>
        <img
            src="{{ url_for('static', filename='img/icon/ionicon/ios-arrow-down.svg') }}"
            class="arrow"
            onclick="gotoEvents()"
        />

    </div>
</div>
{% if current_user.is_authenticated %}
<script>
    window.addEventListener("load", gotoEvents);
</script>
{% endif %}

<div id="eventlist" class="panel">
    <h3>
        Collectives du club
    </h3>
    <div id="filters">
        <div>

            <a      id="pastcheckbox"
                    href="{{ url_for_keep_params("event.index", past=not params['past']) }}#eventlist"
                    class="button button-secondary {{ "checked" if params['past'] }}"
                    >Passées</a>
            <a      id="cancelledcheckbox"
                    href="{{ url_for_keep_params("event.index", confirmed_only=not params['confirmed_only']) }}#eventlist"
                    class="button button-secondary {{ "checked" if not params['confirmed_only'] }}"
                    >Annulées</a>
            <form action="{{ url_for_keep_params("event.index") }}#eventlist" id="search_form">
                {% for key, value in request_args.items() %}
                    {% if key != "search" %}
                        <input type="hidden" value="{{ value }}" name="{{key}}"/>
                    {% endif %}
                {% endfor %}

                <input type="text" value="{{ params['search'] if params['search'] }}" placeholder="Encadrant / Titre" name="search"/>
                <a class="button button-secondary checked" onclick="document.getElementById('search_form').submit();">
                    <img class="icon" src="{{ url_for('static', filename='img/icon/ionicon/search-sharp.svg')}}"/>
                </a>
            </form>
            <div class="select" >
                    <label for="select_display" class="cell" >
                            <img class="chevrons" alt="&#8650;" src="{{ url_for('static', filename='img/icon/ionicon/ios-code.svg') }}" />
                            {% if filtered_activity %}
                                <span class="activity {{filtered_activity.short}} s30px"></span>
                                {{filtered_activity.name}}
                            {% else %}
                                Toutes activités
                            {% endif %}
                    </label>

                    <input type="checkbox" id="select_display" autocomplete="off"/>
                    <label for="select_display" class="closer"></label>

                    {% if filtered_activity != None %}
                        <a href="{{url_for_keep_params("event.index", name=None, activity_type_id=None, page=None) }}#eventlist" class="cell" >
                                    Toutes activités
                        </a>
                    {% endif %}

                    {% for type in types %}
                        {% if type.id != filtered_activity.id %}
                            <a href="{{url_for_keep_params("event.index", name=slugify(type.name), page=None) }}#eventlist" class="cell" >
                                        <span class="activity {{type.short}} s30px"></span>
                                        {{type.name}}
                            </a>
                        {% endif %}
                    {% endfor %}
            </div>
        </div>
    </div>

    {% if pagination.total > 0 %}

        {{ event_macros.event_pagination(pagination, request_args) }}
        <div id="eventstable">
            {% for event in pagination.items %}
                {{ event_macros.eventcell(event) }}
            {% endfor %}
        </div>

        {{ event_macros.event_pagination(pagination, request_args) }}

        <div>{{pagination.total}} collectives correspondent aux critères de recherche.</div>

    {% else %}
        <h4> Aucune collective correspond à vos critères de recherches.</h4>
    {% endif %}
</div>

{% endblock %}
